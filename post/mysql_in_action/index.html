<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>[笔记]MySQL实战45讲 - PPD&#39;s blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="PPD" />
  <meta name="description" content="第一讲：一条SQL查询语句的执行过程 MySQL架构 Server层 连接器： 管理连接，权限验证 分析器：词法分析，语法分析 优化器：索引选择，joi" />

  <meta name="keywords" content="PPD, blog" />






<meta name="generator" content="Hugo 0.55.6" />


<link rel="canonical" href="https://ppd0705.github.io/post/mysql_in_action/" />



<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.ec807d8b802a40889537c26e014f733206312ea440d42e1f0dabed80918de1ac.css" integrity="sha256-7IB9i4AqQIiVN8JuAU9zMgYxLqRA1C4fDavtgJGN4aw=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="[笔记]MySQL实战45讲" />
<meta property="og:description" content="第一讲：一条SQL查询语句的执行过程 MySQL架构 Server层 连接器： 管理连接，权限验证 分析器：词法分析，语法分析 优化器：索引选择，joi" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ppd0705.github.io/post/mysql_in_action/" />
<meta property="article:published_time" content="2020-08-25T21:05:35&#43;08:00"/>
<meta property="article:modified_time" content="2020-08-25T21:05:35&#43;08:00"/>

<meta itemprop="name" content="[笔记]MySQL实战45讲">
<meta itemprop="description" content="第一讲：一条SQL查询语句的执行过程 MySQL架构 Server层 连接器： 管理连接，权限验证 分析器：词法分析，语法分析 优化器：索引选择，joi">


<meta itemprop="datePublished" content="2020-08-25T21:05:35&#43;08:00" />
<meta itemprop="dateModified" content="2020-08-25T21:05:35&#43;08:00" />
<meta itemprop="wordCount" content="5536">



<meta itemprop="keywords" content="MySQL," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[笔记]MySQL实战45讲"/>
<meta name="twitter:description" content="第一讲：一条SQL查询语句的执行过程 MySQL架构 Server层 连接器： 管理连接，权限验证 分析器：词法分析，语法分析 优化器：索引选择，joi"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">PPD's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/about">About</a>
          
        
      </li>
    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      PPD's blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/about">About</a>
          

        

      </li>
    
    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">[笔记]MySQL实战45讲</h1>
      
      <div class="post-meta">
        <time datetime="2020-08-25" class="post-time">
          2020-08-25 21:05:35
        </time>
        <div class="post-category">
            <a href="https://ppd0705.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"> 计算机 </a>
            
          </div>
        <span class="more-meta"> 5536 words </span>
          <span class="more-meta"> 12 min read </span>

        
        

        
        
      </div>
    </header>

    
    

    
    <div class="post-content">
      

<h3 id="第一讲-一条sql查询语句的执行过程">第一讲：一条SQL查询语句的执行过程</h3>

<h4 id="mysql架构">MySQL架构</h4>

<p><img src="/image/mysql_in_action/29691D8C-C1EF-4987-88EA-E83320479CDE.png" alt="0d2070e8f84c4801adbfa03bda1f98d9" /></p>

<h5 id="server层">Server层</h5>

<ul>
<li>连接器： 管理连接，权限验证</li>
<li>分析器：词法分析，语法分析</li>
<li>优化器：索引选择，join顺序选择，执行计划制定</li>
<li>执行器：操作引擎返回结果</li>
</ul>

<h5 id="存储引擎层">存储引擎层</h5>

<ul>
<li>负责数据的存储和提取</li>
</ul>

<h3 id="第二讲-一条sql更新语句的执行过程">第二讲：一条SQL更新语句的执行过程</h3>

<h4 id="两种日志">两种日志</h4>

<ul>
<li>redo log: InnoDB引擎特有的的日志系统；大小固定，循环写；物理日志，记录的是数据页做的改动</li>
<li>binlog: Server层的日志, 逻辑日志，sql语句的原始逻辑</li>
</ul>

<h4 id="更新流程-浅绿色框表示在innodb内部执行">更新流程（浅绿色框表示在InnoDB内部执行）</h4>

<p><img src="/image/mysql_in_action/02DEDD8D-FBB3-492D-8A4F-C51E0EBDB0D0.png" alt="2e5bff4910ec189fe1ee6e2ecc7b4bbe" /></p>

<ul>
<li>redo log 两阶段提交</li>
<li>相关参数设定：

<ul>
<li>innodb_flush_log_at_trx_commit=1表示每次失误的redo log 都持久化到磁盘       - sync_binlog=1表示每次的binlog都持久化到磁盘</li>
</ul></li>
</ul>

<h3 id="第三讲-事务隔离">第三讲：事务隔离</h3>

<h4 id="四种隔离级别">四种隔离级别</h4>

<ul>
<li>读未提交(read uncommitted)：

<ul>
<li>事务还未提交时能被其他事务看到</li>
</ul></li>
<li>读提交(read committed)：

<ul>
<li>事务提交后才能被其他事务看到</li>
</ul></li>
<li>可重复读(repeatable read)(默认选项)：

<ul>
<li>事务执行过程中看到的数据和该事务启动时一致</li>
</ul></li>
<li>串行化(serializable)：

<ul>
<li>读写冲突的时候，后一个事务必须等前一个事务执行完成才能继续执行
<br /></li>
</ul></li>
</ul>

<h4 id="示例">示例</h4>

<h5 id="初始化">初始化</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">CREATE</span> <span class="k">DATABASE</span> <span class="n">TEST</span><span class="p">;</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">T</span><span class="p">(</span><span class="k">c</span> <span class="nb">int</span><span class="p">)</span> <span class="n">engine</span> <span class="n">InnoDB</span><span class="p">;</span>
<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">T</span><span class="p">(</span><span class="k">c</span><span class="p">)</span> <span class="k">values</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span></code></pre></td></tr></table>
</div>
</div>
<h5 id="对于如下示例-在不同的隔离级别-c1-c2-c3-的结果分别是什么">对于如下示例，在不同的隔离级别<code>c1</code>/<code>c2</code>/<code>c3</code>的结果分别是什么？</h5>

<table>
<thead>
<tr>
<th align="center">事务A</th>
<th align="center">事务B</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">start transaction;</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">select * from t;</td>
<td align="center"></td>
</tr>

<tr>
<td align="center"></td>
<td align="center">start transaction;</td>
</tr>

<tr>
<td align="center"></td>
<td align="center">update t set c = c + 1 where c = 1;</td>
</tr>

<tr>
<td align="center">select * from t;(<code>c1</code>)</td>
<td align="center"></td>
</tr>

<tr>
<td align="center"></td>
<td align="center">commit;</td>
</tr>

<tr>
<td align="center">select * from t;(<code>c2</code>)</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">commit;</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">select * from t;(<code>c3</code>)</td>
<td align="center"></td>
</tr>
</tbody>
</table>

<ul>
<li><em>read uncommitted</em> : 均为2</li>
<li><em>read committed</em> : c1为1，c2/c3为2</li>
<li><em>repeatable read</em> : c1/c2为1, c3为2</li>
<li><em>serializable</em> : c1/c2为1, c3为2 (事务B update时阻塞)</li>
</ul>

<h4 id="底层实现逻辑">底层实现逻辑</h4>

<ul>
<li>“读未提交”隔离级别下直接返回记录上的最新值</li>
<li>“串行化”隔离级别下直接用加锁的方式来避免并行访问</li>
<li>“读已提交”事务在每次Read操作时，都会建立Read View</li>
<li>“可重复读”在事务第一次Read时建立一个视图，整个事务存在期间都用这个视图,但是update操作时会读当前并更新视图</li>
</ul>

<h3 id="第四-五讲-索引">第四、五讲：索引</h3>

<h4 id="索引的常见模型">索引的常见模型</h4>

<ul>
<li>哈希表: 适合等值查询的场景</li>
<li>有序数组：适用于静态存储，等值查询和范围查询都适用</li>
<li>搜索树</li>
</ul>

<h4 id="innodb的b-索引模型">InnoDB的B+索引模型</h4>

<ul>
<li>主键索引(clustered index)：叶子节点存有整行数据</li>
<li>二级索引（secondary index）： 叶子节点存有主键的值</li>
</ul>

<h4 id="索引维护">索引维护</h4>

<ul>
<li>自增主键是追加操作，不会触发叶子节点的分裂</li>
<li>主键长度越小，二级索引的叶子节点就越小，更节省空间</li>
<li>数据页太小会加深层数，太大会增加加载时间和查询时间</li>
</ul>

<h4 id="重建表">重建表</h4>

<p>alter table T engine=InnoDB 减少数据空洞</p>

<h4 id="覆盖索引">覆盖索引</h4>

<p>所查询的数据在索引树上，无需再回表</p>

<h4 id="最左前缀原则">最左前缀原则</h4>

<p>索引（a, b）可用于查询条件有a或a和b的情况</p>

<h4 id="索引下推">索引下推</h4>

<p>对索引中包含的字段先做判断， 减少回表次数，如查询 <code>select * from table where name like &quot;王%&quot; and age = 10</code>, 索引为（name, age）,有索引下推时会对索引中的age做判断而非在回表后再判断</p>

<h4 id="其他">其他</h4>

<ul>
<li>主键为(a, b)的表索引c和索引（c, a）等价</li>
</ul>

<h3 id="第六讲-全局锁和表锁">第六讲：全局锁和表锁</h3>

<h4 id="全局锁">全局锁</h4>

<ul>
<li>效果： 加上全局锁是的整个服务处于只读状态</li>

<li><p>加锁命令：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="o">#</span> <span class="n">FTWRL</span>
<span class="n">Flush</span> <span class="n">tables</span> <span class="k">with</span> <span class="k">read</span> <span class="k">lock</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>典型使用场景：做全库逻辑备份</li>
</ul>

<p>注:
- 对于使用InnoDB的库备份是可用 <code>msyqldump --single-transaction</code>
- 全库只读也可用<code>set global readonly=true</code>的方式,但这个对超级用户无效</p>

<h4 id="表级锁">表级锁</h4>

<p>分类有2种： 表锁和元数据锁(MDL：meta data lock)</p>

<h5 id="表锁">表锁</h5>

<ul>
<li><p>语法：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="o">#</span> <span class="err">加锁</span>
<span class="k">lock</span> <span class="n">tables</span> <span class="k">table_name</span> <span class="k">read</span><span class="o">/</span><span class="k">write</span><span class="p">;</span>
<span class="o">#</span> <span class="err">解锁</span>
<span class="n">unlock</span> <span class="n">tables</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div></li>
</ul></li>

<li><p>效果：</p>

<ul>
<li>读锁：其他session写会阻塞,当前session不可写，不可访问其他表</li>
<li>写锁: 其他session读写都会阻塞，当前session不可以访问其他表</li>
</ul></li>
</ul>

<h4 id="元数据锁">元数据锁</h4>

<ul>
<li>获取： 自动获取</li>

<li><p>类型</p>

<ul>
<li>读锁：增删改查操作</li>
<li>写锁：变更表结构</li>
</ul></li>

<li><p>互斥性</p>

<ul>
<li>读锁之间不互斥</li>
<li>读写锁之间、写写锁之间互斥，会发生阻塞
<br />
<br /></li>
</ul></li>
</ul>

<h3 id="第七讲-行锁">第七讲 行锁</h3>

<p>行锁是由引擎层实现的，如MyISAM就不支持</p>

<h4 id="两阶段">两阶段</h4>

<ul>
<li>执行相应语句时加上，事务结束时释放</li>
<li>尽量将最可能锁冲突的的语句放在事务最后</li>
</ul>

<h4 id="死锁">死锁</h4>

<ul>
<li>参数innodb_lock_wait_timeout 锁超时， 默认50s</li>
<li>参数innodb_deadlock_detect,检测死锁，默认打开，复杂度O(n2)，所以尽量控制并发事务量</li>
<li>死锁检测只会在阻塞时才会执行，只会检测依赖的事务</li>
</ul>

<h3 id="第八讲-视图">第八讲 视图</h3>

<p><img src="/image/mysql_in_action/5A850DE9-FF8F-4935-95F9-26CE332387A3.png" alt="68d08d277a6f7926a41cc5541d3dfced" /></p>

<h4 id="一致性读视图-consistent-read-view">一致性读视图（consistent read view）</h4>

<ul>
<li>用于RC和RR隔离级别的实现</li>
<li>begin/start transaction并不会马上启动事务，需要等到第一个执行操作才启动，显式启动可用start transaction with consistent snapshot</li>
<li>每行数据可能有多个版本，每个版本有自己的trx_id(即对应的事务id)，旧的版本需要根据当前版本和undo log计算出了</li>
<li>更新数据都是先读后写，读指读当前的值（current read）, 如果当前的记录的行锁被其他事务占用，就需要等待</li>
<li>读语句加上lock in share mode或for update 也是当前读</li>
<li>读提交隔离级别下，每个语句执行前都会重新算出一个视图</li>
<li>重复读隔离级别下， 事务启动是会建立一个视图</li>
</ul>

<h3 id="第九讲-唯一索引和普通索引的抉择">第九讲 唯一索引和普通索引的抉择</h3>

<h4 id="查询过程">查询过程</h4>

<ul>
<li>数据按页读入内存，InnoDB默认页大小为16KB</li>
</ul>

<h4 id="更新过程">更新过程</h4>

<ul>
<li>当数据在内存中时直接更新</li>
<li>当数据不在内存中， 将更新操作缓存在change buffer中，之后再merge, change buffer减少了随机磁盘访问</li>

<li><p>merge的流程</p>

<ul>
<li>从磁盘读入数据页到内存</li>
<li>依次更新change buffer中相关记录</li>
<li>将内存数据的变更和change buffer的变更写入redo log
<br /></li>
</ul></li>

<li><p>唯一索引需要将数据页读入内存中才能判断唯一性，故不能使用change buffer</p></li>

<li><p>对于普通索引，如果是写多读少的场景如日志系统，适合change buffer</p></li>

<li><p>change buffer用的是buffer pool里面的内存，innodb_change_buffer_max_size设置其百分比</p></li>

<li><p>redo log 会记录在内存数据页更新数据的操作和change buffer的操作；redo log 主要节省的是随机写磁盘的IO消耗，改为顺序写，而change buffer主要节省的是堆积读存盘的IO消耗</p></li>

<li><p>change buffer的数据会持久化到ibdata系统表里，内存不足或checkpoint的时候会触发落盘</p></li>
</ul>

<h3 id="第十讲-mysql为什么会选错索引">第十讲 Mysql为什么会选错索引</h3>

<h4 id="优化器选择索引的逻辑">优化器选择索引的逻辑</h4>

<p>采样统计预估扫描行情
- 方式：选择N个数据页，统计这些页面的不同值，得到一个平均值，然后乘以这个索引的页数，得到这个索引的基数cardinality，基数越大，表示区分度也好
- 更新： 当变更的数据行数超过1/M，会自动触发重新做索引统计</p>

<p>回表也会被优化器列入考虑因素</p>

<p>analyze table 来解决统计信息不准确的问题</p>

<h4 id="选择异常和处理">选择异常和处理</h4>

<ul>
<li>使用force index</li>
<li>修改语句，引导MySQL使用我们期望的索引</li>
<li>新建更适合的索引或者删除多余的索引</li>
</ul>

<h4 id="评论区拾遗">评论区拾遗</h4>

<ul>
<li>where a in (1,3) and b in (2, 4)会转换成 (a=1 and b=2) or (a=1 and b=4) or &hellip;</li>
</ul>

<h3 id="第十一讲-字符串索引">第十一讲 字符串索引</h3>

<h4 id="前缀索引">前缀索引</h4>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">alter</span> <span class="k">table</span> <span class="n">SUser</span> <span class="k">add</span> <span class="k">index</span> <span class="n">index2</span><span class="p">(</span><span class="n">email</span><span class="p">(</span><span class="mi">6</span><span class="p">));</span></code></pre></td></tr></table>
</div>
</div>
<p>使用前缀索引，定义好长度，可以做到既省空间又不用额外增加太多的查询成本，使用前缀索引可能会损失区分度，需要预设一个可接受的比例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="c1">--- 查看不同长度前缀的数量
</span><span class="c1"></span><span class="k">select</span> 
    <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="k">left</span><span class="p">(</span><span class="n">filed</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="err">）</span><span class="k">as</span> <span class="n">L4</span><span class="p">,</span> 
    <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="k">left</span><span class="p">(</span><span class="n">filed</span><span class="p">,,</span><span class="mi">5</span><span class="p">)</span><span class="err">）</span><span class="k">as</span> <span class="n">L5</span><span class="p">,</span> 
    <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="k">left</span><span class="p">(</span><span class="n">filed</span><span class="p">,,</span><span class="mi">6</span><span class="p">)</span><span class="err">）</span><span class="k">as</span> <span class="n">L6</span><span class="p">,</span> 
    <span class="k">count</span><span class="p">(</span><span class="k">distinct</span> <span class="k">left</span><span class="p">(</span><span class="n">filed</span><span class="p">,,</span><span class="mi">7</span><span class="p">)</span><span class="err">）</span><span class="k">as</span> <span class="n">L7</span>
<span class="k">from</span> <span class="n">SUser</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<p>使用前缀索引用不上覆盖索引，对应字段只存了前缀部分</p>

<h4 id="其他-1">其他</h4>

<ul>
<li>如果前缀区分度比后缀区分度低，可倒序存储再建前缀索引提高区分度</li>
<li>可以增加一个int32字段存hash值</li>
</ul>

<h3 id="第十二讲-mysql为什么会-抖动">第十二讲 MySQL为什么会“抖动”</h3>

<h4 id="原因-flush刷脏页">原因： flush刷脏页</h4>

<h4 id="触发场景">触发场景：</h4>

<ul>
<li>redo log写满了</li>
<li>系统内存不足</li>
<li>Mysql空闲时</li>
<li>Mysql正常关闭时</li>
</ul>

<h4 id="刷脏页策略控制">刷脏页策略控制</h4>

<ul>
<li>innodb_io_capacity： 磁盘IO能力，可设成磁盘的IOPS，IOPS可用如下命令测试</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-bash" data-lang="bash"> fio -filename<span class="o">=</span><span class="nv">$filename</span> -direct<span class="o">=</span><span class="m">1</span> -iodepth <span class="m">1</span> -thread -rw<span class="o">=</span>randrw -ioengine<span class="o">=</span>psync -bs<span class="o">=</span>16k -size<span class="o">=</span>500M -numjobs<span class="o">=</span><span class="m">10</span> -runtime<span class="o">=</span><span class="m">10</span> -group_reporting -name<span class="o">=</span>mytest </code></pre></td></tr></table>
</div>
</div>
<ul>
<li>刷盘速度参考因素： 脏页比例，redo log写盘速度</li>
<li>innodb_max_dirty_pages_pct 脏页比例上限，默认值75%， 计算方式Innodb_buffer_pool_pages_dirty/Innodb_buffer_pool_pages_total</li>
<li>innodb_flush_neighbors控制是否把相邻的脏页也顺便一起flush, MySQL8.0默认为0</li>
<li>LSN(log sequence number)日志序号 可以用show engine innodb status 查看</li>
</ul>

<h3 id="第十三讲-表删除">第十三讲 表删除</h3>

<h4 id="表">表</h4>

<ul>
<li>参数innodb_file_per_table控制每个表是否单独存一个文件， 默认为on, 表数据存储在一个以.ibd为后缀的文件中,如果使用drop table, 会直接删除这个文件</li>
</ul>

<h4 id="行">行</h4>

<ul>
<li>删除数据时只是把对应数据标记为已删除，对应位置可以复用，符合范围条件的数据可以复用这个空间</li>
<li>如果整个数据页都标记为删除，可以复用到任何位置</li>
<li>如果相邻的两个数据页利用率都很小，系统会将数据合并到一个页，另外一个数据页被标记为可复用</li>
<li>如果用delete删除整个表，所有的数据页被标记为可复用，但文件不会变小</li>
<li>插入数据可能导致数据页分裂</li>
</ul>

<h4 id="重建表-1">重建表</h4>

<ul>
<li>重建表可以减少数据空洞（每个页留了1/16给后续的更新用）： alter table A engine=InnoDB</li>
</ul>

<p><img src="/image/mysql_in_action/EFDE128B-3C15-447C-B25D-2C73AFA9E38B.png" alt="2d1cfbbeb013b851a56390d38b5321f0" /></p>

<ul>
<li><p>Online DDL(data definition Language)（5.6起重建表的默认流程）</p>

<ul>
<li>建立一个临时文件，用原始表的记录生成B+树，存储到临时文件</li>
<li>同时把期间原始表的操作记录到一个日志文件中</li>
<li>临时文件生成后，将日志中的操作应用到到临时文件</li>
<li>用临时文件提花原始表的数据文件</li>
</ul></li>

<li><p>optimize talbe = recreate table + analyze table(对索引信息做重新统计)</p></li>
</ul>

<h4 id="评论区拾遗-1">评论区拾遗</h4>

<ul>
<li>truntace table t 等于 drop table + create table</li>
<li>重建表时数据页会按90%满的比例来重新整理页数据（10%留给UPDATE使用）</li>
</ul>

<h3 id="第十四讲-count">第十四讲 count(*)</h3>

<p>实现方式</p>

<ul>
<li>MyISAM: 把表的总行数存在了磁盘，查询的时候直接返回这个数</li>
<li>InnoDB：一行一行读取，累计计数</li>
<li>show table status能取得估算的总行数</li>
</ul>

<p>单独实现计数</p>

<ul>
<li>存redis，高效</li>
<li>存mysql另一张表，持久化，可用事务保证一致性</li>
</ul>

<p>不同count的区别</p>

<ul>
<li>count(1)：引擎遍历整张表，但不取值</li>
<li>count(id)：引擎层遍历整张表逐行解析数据将id返回给server层，</li>
<li>count(字段)：引擎层遍历整张表逐行解析数据将对应字段值返回给server层</li>
</ul>

<p>结论：count(字段)&lt;count(主键 id)&lt;count(1)≈count(*)</p>

<h3 id="第十五讲-日志和索引相关问题答疑">第十五讲 日志和索引相关问题答疑</h3>

<h4 id="日志相关">日志相关</h4>

<h5 id="两阶段提交过程中crash">两阶段提交过程中crash</h5>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-mermaid" data-lang="mermaid"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-mermaid" data-lang="mermaid">graph TD
A(写入redolog 处于prepare状态) --&gt; |时刻A| B(写入binlog)
B --&gt; |时刻B| C[提交事务 处于commit状态]</code></pre></td></tr></table>
</div>
</div>
<ul>
<li>时刻A crash: binlog未写入，redo log未提交，事务会回滚</li>
<li>时刻B</li>
<li>如果binglog完整则提交事务</li>
<li>binlog不完整则回滚
<br /></li>
</ul>

<h5 id="binlog如何验证完整性">binlog如何验证完整性</h5>

<ul>
<li>statement格式：最后会有comit</li>
<li>row格式：最后会XID event</li>
<li>5.6.2版本之后还引入了binlog-checksum参数</li>
</ul>

<h5 id="redo-log-和binlog如何关联">redo log 和binlog如何关联</h5>

<p>通过XID关联</p>

<p>奔溃恢复的时候，按顺序扫描redo log，如果既有prepare又有commit的redo log,就直接提交，如果没找commit，则拿XID找对应的binlog</p>

<h5 id="redo-log-buffer">redo log buffer</h5>

<p>一个事务可能有多个操作，操作对应的red log先在redo log buffer中缓存，等执行commit时在写入文件</p>

<h3 id="第十六讲-order-by">第十六讲 order by</h3>

<p>using filesort表示需要排序，MySQL会给每个线程分配一块内存sort_buffer用于排序</p>

<h4 id="全字段排序">全字段排序</h4>

<p>把需要查询的字段一行一行查询出放入sort_buffer，再进行快速排序，如果要排序的数据量小于sort_buff_size,排序在内存中完成，否则会利用磁盘临时文件辅助排序，外部排序一般使用归并排序算法。</p>

<h4 id="rowid排序">rowid排序</h4>

<p>max_length_for_sort_data控制用于排序的行数据长度上限，如果超过这个值就只将排序用到的列和主键列放入sort_buffer，在排完序后再回表找到其他需要的字段. 所以会有两次访问主索引数</p>

<h4 id="课后问题-sessiona-最后看到的a是多少">课后问题: sessionA 最后看到的A是多少</h4>

<table>
<thead>
<tr>
<th align="center">sessionA</th>
<th align="center">sessionB</th>
</tr>
</thead>

<tbody>
<tr>
<td align="center">start transaction;</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">select * from t where id =1; （query result: a=3）</td>
<td align="center"></td>
</tr>

<tr>
<td align="center"></td>
<td align="center">update t set a = 5 where id = 1;</td>
</tr>

<tr>
<td align="center">update t set a = 5 where id = 1;</td>
<td align="center"></td>
</tr>

<tr>
<td align="center">select * from t where id =1;</td>
<td align="center"></td>
</tr>
</tbody>
</table>

<p>答： 取决于binlog_row_image，binlog_row_image=minimal时a=3,binlog_row_image=full为5。因为mysql在full时会读出所有字段，更新前会判断是否需要更新</p>

<h3 id="第十七讲-随机消息">第十七讲 随机消息</h3>

<h4 id="order-by-rand">order by rand</h4>

<p>rand是建一个临时表，每行给一个随机值(0, 1),然后在sort buffer中排序,内存中会用到快排，文件中会用归并排序</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><span class="lnt">1
</span></pre></td>
<td class="lntd">
<pre class="chroma">select word from words order by rand() limit 3;</pre></td></tr></table>
</div>
</div>
<p><code>internal_tmp_disk_storage_engine</code>控制临时表的类型，默认建内存临时表，如果超过了<code>tmp_table_size</code>就会转成磁盘临时表</p>

<h4 id="随机排序法">随机排序法</h4>

<ul>
<li>方法一</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">select</span> <span class="k">max</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="k">min</span><span class="p">(</span><span class="n">id</span><span class="p">)</span> <span class="k">into</span> <span class="o">@</span><span class="n">M</span><span class="p">,</span><span class="o">@</span><span class="n">N</span> <span class="k">from</span> <span class="n">t</span> <span class="p">;</span>
<span class="k">set</span> <span class="o">@</span><span class="n">X</span><span class="o">=</span> <span class="n">floor</span><span class="p">((</span><span class="o">@</span><span class="n">M</span><span class="o">-@</span><span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">rand</span><span class="p">()</span> <span class="o">+</span> <span class="o">@</span><span class="n">N</span><span class="p">);</span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t</span> <span class="k">where</span> <span class="n">id</span> <span class="o">&gt;=</span> <span class="o">@</span><span class="n">X</span> <span class="k">limit</span> <span class="mi">1</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>方法二</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"> <span class="k">select</span> <span class="k">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">into</span> <span class="o">@</span><span class="k">C</span> <span class="k">from</span> <span class="n">t</span><span class="p">;</span>
 <span class="k">set</span> <span class="o">@</span><span class="n">Y</span> <span class="o">=</span> <span class="n">floor</span><span class="p">(</span><span class="o">@</span><span class="k">C</span> <span class="o">*</span> <span class="n">rand</span><span class="p">());</span>
 <span class="k">set</span> <span class="o">@</span><span class="k">sql</span> <span class="o">=</span> <span class="n">concat</span><span class="p">(</span><span class="s2">&#34;select * from t limit &#34;</span><span class="p">,</span> <span class="o">@</span><span class="n">Y</span><span class="p">,</span> <span class="s2">&#34;,1&#34;</span><span class="p">);</span>
 <span class="k">prepare</span> <span class="n">stmt</span> <span class="k">from</span> <span class="o">@</span><span class="k">sql</span><span class="p">;</span>
 <span class="k">execute</span> <span class="n">stmt</span><span class="p">;</span>
 <span class="k">DEALLOCATE</span> <span class="k">prepare</span> <span class="n">stmt</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="第十八讲-隐式转换">第十八讲 隐式转换</h3>

<ul>
<li><p>函数：对字段做了函数操作，就用不上索引，因为可能会破坏索引值的有序性</p></li>

<li><p>隐式类型转化，字符串和数字做比较的话，是将字符串转换成数字</p></li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t</span> <span class="k">where</span> <span class="n">str_a</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="c1">-- 等同于 select * from t where CAST(str_a as signed int) = 100;
</span><span class="c1"></span>
<span class="c1">-- 验证
</span><span class="c1"></span><span class="k">select</span> <span class="s2">&#34;12mw23&#34;</span> <span class="o">=</span> <span class="mi">12</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>隐式字符编码转换</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="c1">-- traddelog字符编码为utf8mb4, trade_detaul为utf8
</span><span class="c1">-- tradeid字段有索引
</span><span class="c1"></span><span class="k">select</span> <span class="n">d</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span> <span class="n">tradelog</span> <span class="n">l</span><span class="p">,</span> <span class="n">trade_detail</span> <span class="n">d</span> <span class="k">where</span> <span class="n">d</span><span class="p">.</span><span class="n">tradeid</span><span class="o">=</span><span class="n">l</span><span class="p">.</span><span class="n">tradeid</span> <span class="k">and</span> <span class="n">l</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> <span class="cm">/*语句Q1*/</span>
<span class="c1">-- 其中查询是用不上索引，因为在tradeid上做了隐式字符转换
</span><span class="c1"></span>
<span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">trade_detail</span> <span class="k">where</span> <span class="n">tradeid</span><span class="o">=</span><span class="err">$</span><span class="n">L2</span><span class="p">.</span><span class="n">tradeid</span><span class="p">.</span><span class="n">value</span><span class="p">;</span><span class="cm">/*语句2*/</span>

<span class="c1">-- 等同于
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">trade_detail</span> <span class="k">where</span> <span class="k">CONVERT</span><span class="p">(</span><span class="n">tradeid</span> <span class="k">USING</span> <span class="n">utf8mb4</span><span class="p">)</span><span class="o">=</span><span class="err">$</span><span class="n">L2</span><span class="p">.</span><span class="n">tradeid</span><span class="p">.</span><span class="n">value</span>

<span class="c1">-- 优化
</span><span class="c1"></span><span class="k">select</span> <span class="n">d</span><span class="p">.</span><span class="o">*</span> <span class="k">from</span> <span class="n">tradelog</span> <span class="n">l</span> <span class="p">,</span> <span class="n">trade_detail</span> <span class="n">d</span> <span class="k">where</span> <span class="n">d</span><span class="p">.</span><span class="n">tradeid</span><span class="o">=</span><span class="k">CONVERT</span><span class="p">(</span><span class="n">l</span><span class="p">.</span><span class="n">tradeid</span> <span class="k">USING</span> <span class="n">utf8</span><span class="p">)</span> <span class="k">and</span> <span class="n">l</span><span class="p">.</span><span class="n">id</span><span class="o">=</span><span class="mi">2</span><span class="p">;</span> 

<span class="c1">-- 原因是tradeid没有了函数操作，即：
</span><span class="c1"></span><span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">trade_detail</span> <span class="k">where</span> <span class="n">tradeid</span> <span class="o">=</span> <span class="k">CONVERT</span><span class="p">(</span><span class="err">$</span><span class="n">L2</span><span class="p">.</span><span class="n">tradeid</span><span class="p">.</span><span class="n">value</span> <span class="k">USING</span> <span class="n">utf8mb4</span><span class="p">)</span></code></pre></td></tr></table>
</div>
</div>
<h3 id="第十九讲-常见的阻塞场景">第十九讲 常见的阻塞场景</h3>

<h4 id="查询长时间不返回">查询长时间不返回</h4>

<ul>
<li>等MDL锁</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="k">lock</span> <span class="k">table</span> <span class="n">t</span> <span class="k">write</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<p>可以通过查询 sys.schema_table_lock_waits 这张表，我们就可以直接找出造成阻塞的 process id</p>

<ul>
<li>等flush</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="n">flush</span> <span class="n">tables</span> <span class="n">t</span> <span class="k">with</span> <span class="k">read</span> <span class="k">lock</span><span class="p">;</span></code></pre></td></tr></table>
</div>
</div>
<ul>
<li>等行锁</li>
</ul>

<p>查询锁占用信息</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre class="chroma"><code class="language-SQL" data-lang="SQL"><span class="n">mysql</span><span class="o">&gt;</span> <span class="k">select</span> <span class="o">*</span> <span class="k">from</span> <span class="n">t</span> <span class="n">sys</span><span class="p">.</span><span class="n">innodb_lock_waits</span> <span class="k">where</span> <span class="n">locked_table</span><span class="o">=</span><span class="s1">&#39;`test`.`t`&#39;</span><span class="err">\</span><span class="k">G</span></code></pre></td></tr></table>
</div>
</div>
<h4 id="查询慢">查询慢</h4>

<ul>
<li>没有命中索引</li>
<li>一致性读时 undolog太多，回滚到对应版本耗时长，这种情况会比当前读慢（<code>lock in share mode</code>)</li>
</ul>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://ppd0705.github.io/tags/mysql/">MySQL</a>
          
        </div>

      
      <nav class="post-nav">
        
          <a class="prev" href="/post/redis_core_technologies/">
            
            <i class="iconfont">
              <svg  class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M691.908486 949.511495l75.369571-89.491197c10.963703-12.998035 10.285251-32.864502-1.499144-44.378743L479.499795 515.267417 757.434875 204.940602c11.338233-12.190647 11.035334-32.285311-0.638543-44.850487l-80.46666-86.564541c-11.680017-12.583596-30.356378-12.893658-41.662889-0.716314L257.233596 494.235404c-11.332093 12.183484-11.041474 32.266891 0.657986 44.844348l80.46666 86.564541c1.772366 1.910513 3.706415 3.533476 5.750981 4.877077l306.620399 321.703933C662.505829 963.726242 680.945807 962.528973 691.908486 949.511495z"></path>
</svg>

            </i>
            <span class="prev-text nav-default">[笔记]Redis核心技术与实战</span>
            <span class="prev-text nav-mobile">Prev</span>
          </a>
        
          <a class="next" href="/post/pydantic_note/">
            <span class="next-text nav-default">[笔记]Pydantic</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "ppd0705/ppd0705.github.io"
            issue-term="utteranc"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="ppd0705@163.com" rel="me noopener" class="iconfont"
      title="email"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/ppd0705" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>


<a href="https://ppd0705.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2020
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        PPD
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>






  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  













</body>
</html>
