<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>[笔记]Go项目开发实战 - PPD&#39;s blog</title>
  

<meta name="renderer" content="webkit" />
<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=yes"/>

<meta name="MobileOptimized" content="width"/>
<meta name="HandheldFriendly" content="true"/>


<meta name="applicable-device" content="pc,mobile">

<meta name="theme-color" content="#f8f5ec" />
<meta name="msapplication-navbutton-color" content="#f8f5ec">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#f8f5ec">

<meta name="mobile-web-app-capable" content="yes">

<meta name="author" content="PPD" />
  <meta name="description" content="规范设计 开源规范 开源协议概述 MIT是相对自由开发的协议 文档规范 最重要的三类文档：README文档、项目文档和API文档 README规范 主要用" />

  <meta name="keywords" content="PPD, blog" />






<meta name="generator" content="Hugo 0.86.0-DEV" />


<link rel="canonical" href="https://ppd0705.github.io/post/go_develop_in_action/" />





<link rel="icon" href="/favicon.ico" />











<link rel="stylesheet" href="/sass/jane.min.b3a8813c06e6d785beba22bf8264e174fa2cb3a396b22f9ba24e2c00c18aaf7f.css" integrity="sha256-s6iBPAbm14W&#43;uiK/gmThdPoss6OWsi&#43;bok4sAMGKr38=" media="screen" crossorigin="anonymous">





<meta property="og:title" content="[笔记]Go项目开发实战" />
<meta property="og:description" content="规范设计 开源规范 开源协议概述 MIT是相对自由开发的协议 文档规范 最重要的三类文档：README文档、项目文档和API文档 README规范 主要用" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ppd0705.github.io/post/go_develop_in_action/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-06-28T07:28:37+08:00" />
<meta property="article:modified_time" content="2021-06-28T07:28:37+08:00" />

<meta itemprop="name" content="[笔记]Go项目开发实战">
<meta itemprop="description" content="规范设计 开源规范 开源协议概述 MIT是相对自由开发的协议 文档规范 最重要的三类文档：README文档、项目文档和API文档 README规范 主要用"><meta itemprop="datePublished" content="2021-06-28T07:28:37+08:00" />
<meta itemprop="dateModified" content="2021-06-28T07:28:37+08:00" />
<meta itemprop="wordCount" content="7132">
<meta itemprop="keywords" content="Golang," /><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="[笔记]Go项目开发实战"/>
<meta name="twitter:description" content="规范设计 开源规范 开源协议概述 MIT是相对自由开发的协议 文档规范 最重要的三类文档：README文档、项目文档和API文档 README规范 主要用"/>

<!--[if lte IE 9]>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js"></script>
<![endif]-->

<!--[if lt IE 9]>
  <script src="https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js"></script>
<![endif]-->




</head>
<body>
  <div id="mobile-navbar" class="mobile-navbar">
  <div class="mobile-header-logo">
    <a href="/" class="logo">PPD's blog</a>
  </div>
  <div class="mobile-navbar-icon">
    <span></span>
    <span></span>
    <span></span>
  </div>
</div>
<nav id="mobile-menu" class="mobile-menu slideout-menu">
  <ul class="mobile-menu-list">
    <li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/">Home</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/post/">Archives</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/tags/">Tags</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/categories/">Categories</a>
          
        
      </li><li class="mobile-menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/about">About</a>
          
        
      </li>
    

    
  </ul>
</nav>


  
    






  <link rel="stylesheet" href="/lib/photoswipe/photoswipe.min.css" />
  <link rel="stylesheet" href="/lib/photoswipe/default-skin/default-skin.min.css" />




<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>

  

  

  

  <header id="header" class="header container">
    <div class="logo-wrapper">
  <a href="/" class="logo">
    
      PPD's blog
    
  </a>
</div>

<nav class="site-navbar">
  <ul id="menu" class="menu">
    
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/">Home</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/post/">Archives</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/tags/">Tags</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/categories/">Categories</a>
          

        

      </li>
    
        <li class="menu-item">
        
          
          
            <a class="menu-item-link" href="https://ppd0705.github.io/about">About</a>
          

        

      </li>
    

    
    

    
  </ul>
</nav>

  </header>

  <div id="mobile-panel">
    <main id="main" class="main bg-llight">
      <div class="content-wrapper">
        <div id="content" class="content container">
          <article class="post bg-white">
    
    <header class="post-header">
      <h1 class="post-title">[笔记]Go项目开发实战</h1>
      
      <div class="post-meta">
        <time datetime="2021-06-28" class="post-time">
          2021-06-28
        </time>
        <div class="post-category">
            <a href="https://ppd0705.github.io/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA/"> 计算机 </a>
            
          </div>
        <span class="more-meta"> 7132 words </span>
          <span class="more-meta"> 15 min read </span>

        
        

        
        
      </div>
    </header>

    
    
<div class="post-toc" id="post-toc">
  <h2 class="post-toc-title">Table of Contents</h2>
  <div class="post-toc-content">
    <nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#规范设计">规范设计</a>
          <ul>
            <li><a href="#开源规范">开源规范</a>
              <ul>
                <li><a href="#开源协议概述">开源协议概述</a></li>
              </ul>
            </li>
            <li><a href="#文档规范">文档规范</a>
              <ul>
                <li><a href="#readme规范">README规范</a></li>
                <li><a href="#项目文档规范">项目文档规范</a></li>
                <li><a href="#api接口规范">API接口规范</a></li>
              </ul>
            </li>
            <li><a href="#版本规范">版本规范</a></li>
            <li><a href="#commit规范">Commit规范</a>
              <ul>
                <li><a href="#header">Header</a></li>
                <li><a href="#body">Body</a></li>
                <li><a href="#footer">Footer</a></li>
                <li><a href="#revert-commit">Revert Commit</a></li>
                <li><a href="#其他">其他</a></li>
              </ul>
            </li>
            <li><a href="#目录结构设计">目录结构设计</a>
              <ul>
                <li><a href="#目录介绍">目录介绍</a></li>
                <li><a href="#其他建议">其他建议</a></li>
              </ul>
            </li>
            <li><a href="#工作流设计">工作流设计</a>
              <ul>
                <li><a href="#功能分支工作流">功能分支工作流</a></li>
                <li><a href="#git-flow工作流">Git Flow工作流</a></li>
                <li><a href="#forking工作流">Forking工作流</a></li>
              </ul>
            </li>
            <li><a href="#研发流程设计">研发流程设计</a>
              <ul>
                <li><a href="#研发流程">研发流程</a></li>
                <li><a href="#研发模式">研发模式</a></li>
                <li><a href="#cicd">CI/CD</a></li>
                <li><a href="#devops">DevOps</a></li>
              </ul>
            </li>
            <li><a href="#设计方法">设计方法</a>
              <ul>
                <li><a href="#代码结构">代码结构</a></li>
                <li><a href="#代码规范">代码规范</a></li>
                <li><a href="#代码质量">代码质量</a></li>
                <li><a href="#编程哲学">编程哲学</a></li>
                <li><a href="#软件设计方法">软件设计方法</a></li>
                <li><a href="#高效项目管理">高效项目管理</a></li>
              </ul>
            </li>
            <li><a href="#设计模式">设计模式</a>
              <ul>
                <li><a href="#创建型模式">创建型模式</a></li>
                <li><a href="#结构型模式">结构型模式</a></li>
                <li><a href="#行为型模式">行为型模式</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#基础功能设计和开发">基础功能设计和开发</a>
          <ul>
            <li><a href="#api风格">API风格</a>
              <ul>
                <li><a href="#restful-api设计原则">Restful API设计原则</a></li>
                <li><a href="#rpc-api">RPC API</a></li>
              </ul>
            </li>
            <li><a href="#makefile">Makefile</a></li>
          </ul>
        </li>
        <li><a href="#参考">参考</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </div>
</div>

    
    <div class="post-content">
      <h2 id="规范设计">规范设计</h2>
<h3 id="开源规范">开源规范</h3>
<h4 id="开源协议概述">开源协议概述</h4>
<p>MIT是相对自由开发的协议</p>
<p><img src="/image/go_develop_in_action/4_1.png" alt="opensource_proctol"></p>
<h3 id="文档规范">文档规范</h3>
<p>最重要的三类文档：README文档、项目文档和API文档</p>
<h4 id="readme规范">README规范</h4>
<p>主要用来介绍项目的功能、安装、部署和使用</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"># 项目名称

&lt;!-- 写一段简短的话描述项目 --&gt;

## 功能特性

&lt;!-- 描述该项目的核心功能点 --&gt;

## 软件架构(可选)

&lt;!-- 可以描述下项目的架构 --&gt;

## 快速开始

### 依赖检查

&lt;!-- 描述该项目的依赖，比如依赖的包、工具或者其他任何依赖项 --&gt;

### 构建

&lt;!-- 描述如何构建该项目 --&gt;

### 运行

&lt;!-- 描述如何运行该项目 --&gt;

## 使用指南

&lt;!-- 描述如何使用该项目 --&gt;

## 如何贡献

&lt;!-- 告诉其他开发者如果给该项目贡献源码 --&gt;

## 社区(可选)

&lt;!-- 如果有需要可以介绍一些社区相关的内容 --&gt;

## 关于作者

&lt;!-- 这里写上项目作者 --&gt;

## 谁在用(可选)

&lt;!-- 可以列出使用本项目的其他有影响力的项目，算是给项目打个广告吧 --&gt;

## 许可证

&lt;!-- 这里链接上该项目的开源许可证 --&gt;
</code></pre></td></tr></table>
</div>
</div><h4 id="项目文档规范">项目文档规范</h4>
<p>通常放在<code>/docs</code>目录下，包含开发文档和用户文档</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-path" data-lang="path"><span class="err">docs</span>
<span class="err">├──</span> <span class="err">devel</span>                            <span class="c"># 开发文档，可以提前规划好，英文版文档和中文版文档</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="err">en-US/</span>                       <span class="c"># 英文版文档，可以根据需要组织文件结构</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="err">zh-CN</span>                        <span class="c"># 中文版文档，可以根据需要组织文件结构</span>
<span class="err">│</span>       <span class="err">└──</span> <span class="err">development.md</span>           <span class="c"># 开发手册，可以说明如何编译、构建、运行项目</span>
<span class="err">├──</span> <span class="err">guide</span>                            <span class="c"># 用户文档</span>
<span class="err">│</span>   <span class="err">├──</span> <span class="err">en-US/</span>                       <span class="c"># 英文版文档，可以根据需要组织文件结构</span>
<span class="err">│</span>   <span class="err">└──</span> <span class="err">zh-CN</span>                        <span class="c"># 中文版文档，可以根据需要组织文件结构</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">api/</span>                     <span class="c"># API文档</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">best-practice</span>            <span class="c"># 最佳实践，存放一些比较重要的实践文章</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">└──</span> <span class="err">authorization.md</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">faq</span>                      <span class="c"># 常见问题</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">├──</span> <span class="err">iam-apiserver</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">└──</span> <span class="err">installation</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">installation</span>             <span class="c"># 安装文档</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">└──</span> <span class="err">installation.md</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">introduction/</span>            <span class="c"># 产品介绍文档</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">operation-guide</span>          <span class="c"># 操作指南，里面可以根据RESTful资源再划分为更细的子目录，用来存放系统核心/全部功能的操作手册</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">├──</span> <span class="err">policy.md</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">├──</span> <span class="err">secret.md</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">└──</span> <span class="err">user.md</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">quickstart</span>               <span class="c"># 快速入门</span>
<span class="err">│</span>       <span class="err">│</span>   <span class="err">└──</span> <span class="err">quickstart.md</span>
<span class="err">│</span>       <span class="err">├──</span> <span class="err">README.md</span>                <span class="c"># 用户文档入口文件</span>
<span class="err">│</span>       <span class="err">└──</span> <span class="err">sdk</span>                      <span class="c"># SDK文档</span>
<span class="err">│</span>           <span class="err">└──</span> <span class="err">golang.md</span>
<span class="err">└──</span> <span class="err">images</span>                           <span class="c"># 图片存放目录</span>
    <span class="err">└──</span> <span class="err">部署架构v1.png</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="api接口规范">API接口规范</h4>
<p>API文档生成方式包括通过注释生成、编写Markdown格式文档, 通常拆分为多个文件</p>
<ul>
<li>README: API介绍整体文档</li>
<li>CHANGELOG: PAI变更历史</li>
<li>generic: 通用的请求参数、返回参数、认证方法、响应状态码等说明</li>
<li>struct: 接口使用的数据结构</li>
<li>error_code: 业务错误码说明</li>
<li>按资源划分API文档： API详细说明</li>
</ul>
<h3 id="版本规范">版本规范</h3>
<p>版本格式为：主版本号.次版本号.修订号（X.Y.Z）</p>
<p>版本号递增规则</p>
<ul>
<li>主版本（major）: 不兼容API修改</li>
<li>次版本（minor）: 新增功能（一般偶数为稳定版，奇数为开发版本）</li>
<li>修订版本：问题修正</li>
</ul>
<p>版本号建议</p>
<ul>
<li>开始开发时，以0.1.0作为第一个开发版本号，后续发行时递增次版本号</li>
<li>发布第一个稳定版时定为1.0.0</li>
<li>后续迭代
<ul>
<li>fix commit将修订版本+1</li>
<li>feat commit将次版本号+1</li>
<li>BREAKING CHANGE commit将主版本号+1</li>
</ul>
</li>
</ul>
<p><img src="/image/go_develop_in_action/5_1.webp" alt="commit_types"></p>
<h3 id="commit规范">Commit规范</h3>
<p>采用Angular风格的Commit Message, 其包含三个部分：Header、Body和Footer，具体格式如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">&lt;type&gt;[optional scope]: &lt;description&gt;
// blank line
[optional body]
// blink line
[optional footer]
</code></pre></td></tr></table>
</div>
</div><h4 id="header">Header</h4>
<p><code>type</code>说明commit类型，主要分为Development和Production两大类</p>
<ul>
<li>Development类别修改的是项目管理类的变更，如CI流程、构建方式等，不会影响到最终用户，具体类型
<ul>
<li>style：代码格式类的变更，如格式化代码、删除空行等</li>
<li>test： 增加或更新测试用例</li>
<li>ci：持续集成和部署相关的改动</li>
<li>docs：更新文档</li>
<li>chore：其他类型，如构建流程、依赖管理或辅助工具的变更等</li>
</ul>
</li>
<li>Production类别会影响到最终用户，提交前需要做好充分的测试
<ul>
<li>feat: 新增功能</li>
<li>fix: bug修复</li>
<li>perf: 提高代码性能的变更</li>
<li>refactor: 不属于上面三类的其他类型，如简化代码、重命名变量等</li>
</ul>
</li>
</ul>
<p><code>scope</code>用来说明影响范围，应根据项目情况设计大类如api、pkg、docs等</p>
<p><code>descrption</code>是对commit的简单描述，必须以动词开头，使用现在时态，结尾不加句号</p>
<h4 id="body">Body</h4>
<p>body是对commit的详细描述，同样以动词开头，使用现在时态，内容包含改动的原因和改动点</p>
<h4 id="footer">Footer</h4>
<p>通产用来说明不兼容的改动和关闭的issue，如下示例</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">BREAKING CHANGE: XXXXX
Cloes: #123, #234
</code></pre></td></tr></table>
</div>
</div><h4 id="revert-commit">Revert Commit</h4>
<p>当还原commit的时，在还原的Header前面加<code>revert: </code>, Body里面说明还原的commit hash，如：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">revert: feat(api): add &#39;Host&#39; option

This reverts commit fjsdf34353534vdf
</code></pre></td></tr></table>
</div>
</div><h4 id="其他">其他</h4>
<p>合并提交： 对于过多的commit使用<code>git rebase</code>进行合并</p>
<p>修改message: 使用<code>git rebase</code>(注：修改message会将导致当前及置换的hash变更)</p>
<p>自动化工具:</p>
<ul>
<li><a href="https://github.com/lintingzhen/commitizen-go">commitizen-go</a>：格式化填充commit message</li>
<li><a href="https://github.com/llorllale/go-gitlint">gitlint</a>: 检查commit message</li>
<li><a href="https://github.com/git-chglog/git-chglog">git-changelog</a>: 自动生成change log</li>
<li><a href="https://github.com/arnaud-deprez/gsemver">gmemver</a>: 语义化版本自动生成</li>
</ul>
<h3 id="目录结构设计">目录结构设计</h3>
<p><img src="/image/go_develop_in_action/6_1.webp" alt="project-layer"></p>
<h4 id="目录介绍">目录介绍</h4>
<h5 id="1-web">1. /web</h5>
<p>web目录主要存放web静态资源</p>
<h5 id="2-cmd">2. /cmd</h5>
<p>一个项目可能有多个组件，每个组件的main函数所在文件夹放在该目录</p>
<h5 id="3-internal">3. /internal</h5>
<p>存放私有应用的代码，不能被其他项目导入</p>
<p>项目内应用之间共享代码存放于/internal/pkg</p>
<p>开发建议：最开始将共享代码都放/internal/pkg，做好对外发布的准备时再转到/pkg目录</p>
<p>IAM项目internal目录结构如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">├── apiserver
│   ├── api
│   │   └── v1
│   │       └── user
│   ├── options
│   ├── config
│   ├── service
│   │   └── user.go
│   ├── store
│   │   ├── mysql
│   │   │   └── user.go
│   │   ├── fake
│   └── testing
├── authzserver
│   ├── api
│   │   └── v1
│   ├── options
│   ├── store
│   └── testing
├── iamctl
│   ├── cmd
│   │   ├── cmd.go
│   │   ├── info
└── pkg
    ├── code
    ├── middleware
    ├── options
    └── validation
</code></pre></td></tr></table>
</div>
</div><p>主要分为三大类</p>
<ul>
<li>/internal/pkg: 内部共享包存放目录</li>
<li>/internal/iamctl: 对于大型项目，可能会存在客户端工具</li>
<li>/internal/apiserver: 应用目录</li>
</ul>
<p>针对具体的应用目录，也会根据功能来划分：</p>
<ul>
<li>/internal/apiserver/api/v1: HTTP API接口具体实现</li>
<li>/internal/apiserver/options: command flag</li>
<li>/internal/apiserver/service: 业务逻辑代码</li>
<li>/internal/apiserver/store/mysql: 数据库交互</li>
</ul>
<p>/internal/pkg通常也会划分：</p>
<ul>
<li>/internal/pkg/code: 业务Code码</li>
<li>/internal/pkg/validation: 通用验证函数</li>
<li>/internal/pkg/code: HTTP处理链</li>
</ul>
<h5 id="4-pkg">4. /pkg</h5>
<p>pkg目录存放外部应用可以使用的代码库，应谨慎考虑</p>
<h5 id="5-vendor">5. /vendor</h5>
<p>项目依赖，通过<code>go mod vendor</code>创建</p>
<h5 id="6-third_party">6. /third_party</h5>
<p>外部帮助工具，比如fork了一个第三方go包，并做了小改动，可以放置该目录</p>
<h5 id="7-test">7. /test</h5>
<p>存放其他外部测试应用和测试数据</p>
<h5 id="8-configs">8. /configs</h5>
<p>存放配置文件模板或默认配置</p>
<h5 id="9-deployments">9. /deployments</h5>
<p>存放系统和容器编排部署模板和配置</p>
<h5 id="10-init">10. /init</h5>
<p>存放初始化系统和进程管理配置文件，如systemd、supervisord等</p>
<h5 id="11-makefile">11. /Makefile</h5>
<p>项目管理文件</p>
<h5 id="12-scripts">12. /scripts</h5>
<p>存放脚本文件，通常可能分为三个目录</p>
<ul>
<li>/scripts/make-rules: 存放maker文件，实现Makerfile文件中的各个功能</li>
<li>/scripts/lib: 存放shell脚本</li>
<li>/scripts/intall: 如果项目支持自动化部署，可以将部署脚本放在该目录</li>
</ul>
<h5 id="13-build">13. /build</h5>
<p>存放安装包和持续集成相关的文件，通常可能包含三个目录</p>
<ul>
<li>/build/package: 存放容器（Docker）、系统(deb,rpm)的包配置和脚本</li>
<li>/build/ci: 存放CI（travis，circle）的配置文件</li>
<li>/build/docker: 存放子项目各个组件的Dockerfile文件</li>
</ul>
<h5 id="14-tools">14. /tools</h5>
<p>存放这个项目的支持工具，这些工具可导入来自/pkg和/internal目录的代码</p>
<h5 id="15-githooks">15. /githooks</h5>
<p>git钩子</p>
<h5 id="16-assets">16. /assets</h5>
<p>项目使用的其他资源（图片、CSS、Javascript等）</p>
<h5 id="17-website">17. /website</h5>
<p>放置项目网站相关的数据</p>
<h5 id="18-readmemd">18. /README.md</h5>
<p>一般包含项目介绍、功能介绍、快速按照、使用指引、详细文档连接和开发指引等
文件较长时可以用<a href="https://github.com/nochso/tocenize">tocenize</a>加目录</p>
<h5 id="19-docs">19. /docs</h5>
<p>存放设计文档、开放文档和用户文档等，可能包含下面几个目录</p>
<p>/docs/devel/{en-US, zh-CN}: 存放开发文档
/docs/guide/{en-US, zh-CN}: 存放用户手册
/docs/images: 存放图片文件</p>
<h5 id="20-contributingmd">20. /CONTRIBUTING.md</h5>
<p>用来说明如何贡献代码，规范协同流程</p>
<h5 id="21-api">21. /api</h5>
<p>存放项目提供的各种不同类型的API接口定义文件，可能有openapi、swagger等目录</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">├── openapi/
│   └── README.md
└── swagger/
    ├── docs/
    ├── README.md
    └── swagger.yaml
</code></pre></td></tr></table>
</div>
</div><h5 id="22-license">22. /LICENSE</h5>
<p>版权文件</p>
<p>如果需要给源码文件加license头时，可以使用<a href="https://github.com/marmotedu/addlicense">addlicense</a></p>
<p>项目依赖第三方包使用的license检查使用<a href="https://github.com/ribice/glice">glice</a></p>
<h5 id="23-changelog">23. /CHANGELOG</h5>
<p>项目更新日志，可结合Angular规范和git-chglog自动生成内容</p>
<h5 id="24-examples">24. /examples</h5>
<p>存放代码示例</p>
<h4 id="其他建议">其他建议</h4>
<ul>
<li>不使用/model目录，按功能拆分到使用的模块中</li>
<li>目录和包尽量使用单数</li>
<li>小项目可以先包含cmd、pkg、internal三个目录</li>
</ul>
<h3 id="工作流设计">工作流设计</h3>
<h4 id="功能分支工作流">功能分支工作流</h4>
<p>开发新功能时，基于master分支新建一个功能分支，在功能分支上进行开发，开发完之后合并到master</p>
<p>该模式适合小规模、人员固定的项目</p>
<h4 id="git-flow工作流">Git Flow工作流</h4>
<p>Git Flow定义了5种分支： master、develop、release、 feature、hotfix，详细介绍如下</p>
<p><img src="/image/go_develop_in_action/7_1.webp" alt="git-flow"></p>
<p>假设当前在一个future分支开发，突然发现了线上bug，需要hotfix，则流程如下：</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ git stash <span class="c1"># 1. 开发工作只完成了一半，还不想提交，可以临时保存修改至堆栈区</span>
$ git checkout -b hotfix/print-error master <span class="c1"># 2. 从 master 建立 hotfix 分支</span>
$ vi main.go <span class="c1"># 3. 修复 bug，callmainfunction -&gt; call main function</span>
$ git commit -a -m <span class="s1">&#39;fix print message error bug&#39;</span> <span class="c1"># 4. 提交修复</span>
$ git checkout develop <span class="c1"># 5. 切换到 develop 分支</span>
$ git merge --no-ff hotfix/print-error <span class="c1"># 6. 把 hotfix 分支合并到 develop 分支</span>
$ git checkout master <span class="c1"># 7. 切换到 master 分支</span>
$ git merge --no-ff hotfix/print-error <span class="c1"># 8. 把 hotfix 分支合并到 master</span>
$ git tag -a v0.9.1 -m <span class="s2">&#34;fix log bug&#34;</span> <span class="c1"># 9. master 分支打 tag</span>
$ go build -v . <span class="c1"># 10. 编译代码，并将编译好的二进制更新到生产环境</span>
$ git branch -d hotfix/print-error <span class="c1"># 11. 修复好后，删除 hotfix/xxx 分支</span>
$ git checkout feature/print-hello-world <span class="c1"># 12. 切换到开发分支下</span>
$ git merge --no-ff develop <span class="c1"># 13. 因为 develop 有更新，这里最好同步更新下</span>
$ git stash pop <span class="c1"># 14. 恢复到修复前的工作状态</span>
</code></pre></td></tr></table>
</div>
</div><p>该模式适合人员固定、规模较大的项目</p>
<h4 id="forking工作流">Forking工作流</h4>
<p>开源项目常用模式</p>
<p><img src="/image/go_develop_in_action/7_2.webp" alt="git-forking"></p>
<h3 id="研发流程设计">研发流程设计</h3>
<h4 id="研发流程">研发流程</h4>
<p>通常研发流程包括6个阶段</p>
<ol>
<li>需求阶段</li>
<li>设计阶段</li>
<li>开发阶段</li>
<li>测试阶段</li>
<li>发布阶段</li>
<li>运营阶段</li>
</ol>
<p><img src="/image/go_develop_in_action/8_1.png" alt="git-forking"></p>
<p>每个阶段结束时，需要一个最终产物，可以是文档、代码或者部署组件，这个产物是下一个阶段的输入</p>
<h4 id="研发模式">研发模式</h4>
<p>研发模式有三种： 瀑布模式、迭代模式和敏捷模式</p>
<h5 id="瀑布模式">瀑布模式</h5>
<p>瀑布墨迹按照预先规划好的阶段来推进研发进度，流程清晰,但研发周期长，交付后变更困难
<img src="/image/go_develop_in_action/8_2.webp" alt="git-forking"></p>
<h5 id="迭代模式">迭代模式</h5>
<p>研发任务被切分为一系列轮次，先把主要功能搭建起来，在通过客户反馈不断完善</p>
<h5 id="敏捷模式">敏捷模式</h5>
<p>敏捷模式把大需求分成多个、可分阶段完成的小迭代，每个迭代交付都是一个可用的软件，开发过程中，软件一直处于可用状态</p>
<p>迭代模式关注研发流程。而敏捷模式不仅会关注研发流程，还会关注之外的一些东西，例如：团队协作，需求拆分</p>
<h4 id="cicd">CI/CD</h4>
<p>CI/CD通过自动化的手段来快速执行代码检查、测试、构建和部署任务，从而提高研发效率</p>
<ul>
<li>CI：Continuous Integration，持续集成</li>
<li>CD：Continuous Delivery，持续交付</li>
<li>CD：Continuous Deployment，持续部署</li>
</ul>
<p><img src="/image/go_develop_in_action/8_3.webp" alt="git-forking"></p>
<p>持续集成的核心在代码，持续交付的核心在可交付的产物，持续部署的核心在自动部署</p>
<h5 id="持续集成">持续集成</h5>
<p>在代码push到git仓库后，CI工具会进行扫描、测试和构建，并将结果反馈给开发者</p>
<p>CI流程可以将问题在开发阶段就暴露出来，这会让开发人员交付代码时更有信心</p>
<h5 id="持续交付">持续交付</h5>
<p>在持续集成的基础上，就构建产物自动部署到目标环境（测试、预发布）</p>
<h5 id="持续部署">持续部署</h5>
<p>在持续交付的基础上，将经过充分测试的代码自动部署到生产环境，整个流程不在需要审核，完全自动化</p>
<h4 id="devops">DevOps</h4>
<p>DevOps是一组过程、方法和系统的统称，用于促进开发、运维、质量部门之间的协作整合
<img src="/image/go_develop_in_action/8_4.webp" alt="git-forking"></p>
<p>目前常用的Ops手段： AIOps、ChatOps、GitOps</p>
<h5 id="chatops">ChatOps</h5>
<p>通过发送指令给聊天机器人，执行某个任务
ChatOps对操作者友好，信息透明可追溯</p>
<h5 id="gitops">GitOps</h5>
<p>基于Git和K8S实现云原生的持续交付</p>
<h5 id="aiops">AIOps</h5>
<p>利用AI技术来智能化运维IT系统</p>
<h3 id="设计方法">设计方法</h3>
<p><img src="/image/go_develop_in_action/10_1.webp" alt="go-application"></p>
<h4 id="代码结构">代码结构</h4>
<p>按功能拆分目录而非按MVC等模块拆封</p>
<h4 id="代码规范">代码规范</h4>
<p>可参考Uber的规范：<a href="https://github.com/uber-go/guide/blob/master/style.md">Go Style Guide</a></p>
<p>可使用惊呆检查工具：<a href="https://github.com/golangci/golangci-lint">golangcli-lint</a></p>
<p>官方CodeReview实践：<a href="https://github.com/golang/go/wiki/CodeReviewComments">Go Code Review Comments</a></p>
<h4 id="代码质量">代码质量</h4>
<p>测试相关工具：</p>
<ul>
<li>官方Mock框架： <a href="https://github.com/golang/mock">golang/mock</a></li>
<li>数据库Mock： <a href="https://github.com/DATA-DOG/go-sqlmock">golang/mock</a></li>
<li>HTTP Mock： <a href="https://github.com/jarcoal/httpmock">golang/mock</a></li>
<li>万能Mock： <a href="https://github.com/bouk/monkey">golang/mock</a></li>
</ul>
<p>覆盖率检查</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">$ go <span class="nb">test</span> -race -cover  -coverprofile<span class="o">=</span>./coverage.out -timeout<span class="o">=</span>10m -short -v ./...
$ go tool cover -func ./coverage.out
</code></pre></td></tr></table>
</div>
</div><h4 id="编程哲学">编程哲学</h4>
<ul>
<li>面向接口编程</li>
<li>面向对象编程</li>
</ul>
<h4 id="软件设计方法">软件设计方法</h4>
<ul>
<li>设计模式</li>
<li>SOLD原则</li>
</ul>
<h4 id="高效项目管理">高效项目管理</h4>
<ul>
<li>
<p>使用Makefile管理项目</p>
</li>
<li>
<p>自动生成代码
<img src="/image/go_develop_in_action/10_2.webp" alt="automate-code"></p>
</li>
<li>
<p>对接CI、CD</p>
</li>
<li>
<p>编写高质量的文档</p>
</li>
</ul>
<h3 id="设计模式">设计模式</h3>
<p><img src="/image/go_develop_in_action/11_1.webp" alt="design-pattern"></p>
<h4 id="创建型模式">创建型模式</h4>
<p>创建型模式（Creational Patterns）提供了在创建对象的同事隐藏创建逻辑的方式，而不是使用new运算符直接实例化对象。</p>
<p>比较常见的是单例模式和工厂模式</p>
<h5 id="单例模式">单例模式</h5>
<p>单例模式（Singleton Pattern）指全局只有一个实例，有利于减少内存开销，防止冲突等优点，常用于数据库实例、全局配置等</p>
<ul>
<li>饿汉模式：初始化时创建</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">singleton</span>

<span class="kd">type</span> <span class="nx">singleton</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">ins</span> <span class="o">*</span><span class="nx">singleton</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">singleton</span><span class="p">{}</span>

<span class="kd">func</span> <span class="nf">GetInsOr</span><span class="p">()</span> <span class="o">*</span><span class="nx">singleton</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">ins</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>懒汉模式：实际使用时创建，可能有并发问题，需要加锁</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">singleton</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;sync&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">singleton</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">var</span> <span class="nx">ins</span> <span class="o">*</span><span class="nx">singleton</span>
<span class="kd">var</span> <span class="nx">once</span> <span class="nx">sync</span><span class="p">.</span><span class="nx">Once</span>

<span class="kd">func</span> <span class="nf">GetInsOr</span><span class="p">()</span> <span class="o">*</span><span class="nx">singleton</span> <span class="p">{</span>
  <span class="nx">once</span><span class="p">.</span><span class="nf">Do</span><span class="p">(</span><span class="kd">func</span><span class="p">()</span> <span class="p">{</span>
    <span class="nx">ins</span> <span class="p">=</span> <span class="o">&amp;</span><span class="nx">singleton</span><span class="p">{}</span>
  <span class="p">})</span>
  <span class="k">return</span> <span class="nx">ins</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="工厂模式">工厂模式</h5>
<ul>
<li>简单工厂模式：接受参数，返回一个对象实例</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">Name</span> <span class="kt">string</span>
  <span class="nx">Age</span>  <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">p</span> <span class="nx">Person</span><span class="p">)</span> <span class="nf">Greet</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;Hi, my name is %s\n&#34;</span><span class="p">,</span> <span class="nx">p</span><span class="p">.</span><span class="nx">Name</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewPerson</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">age</span> <span class="kt">int</span><span class="p">)</span> <span class="o">*</span><span class="nx">Person</span> <span class="p">{</span>
  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Person</span><span class="p">{</span>
  <span class="nx">Name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>
  <span class="nx">Age</span><span class="p">:</span>  <span class="nx">age</span><span class="p">,</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><ul>
<li>抽象工厂模式: 返回接口而非结构体</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go">
<span class="kd">type</span> <span class="nx">Doer</span> <span class="kd">interface</span> <span class="p">{</span>
    <span class="nf">Do</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewHTTPClient</span><span class="p">()</span> <span class="nx">Doer</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">http</span><span class="p">.</span><span class="nx">Client</span><span class="p">{}</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">mockHTTPClient</span> <span class="kd">struct</span><span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">mockHTTPClient</span><span class="p">)</span> <span class="nf">Do</span><span class="p">(</span><span class="nx">req</span> <span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Request</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">http</span><span class="p">.</span><span class="nx">Response</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">res</span> <span class="o">:=</span> <span class="nx">httptest</span><span class="p">.</span><span class="nf">NewRecorder</span><span class="p">()</span>
    <span class="k">return</span> <span class="nx">res</span><span class="p">.</span><span class="nf">Result</span><span class="p">(),</span> <span class="kc">nil</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewMockHTTPClient</span><span class="p">()</span> <span class="nx">Doer</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">&amp;</span><span class="nx">mockHTTPClient</span><span class="p">{}</span>
<span class="p">}</span>  
</code></pre></td></tr></table>
</div>
</div><ul>
<li>工厂方法模式: 通过实现工厂接口来创建多种工厂</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go">
<span class="kd">type</span> <span class="nx">Person</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">name</span> <span class="kt">string</span>
  <span class="nx">age</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">NewPersonFactory</span><span class="p">(</span><span class="nx">age</span> <span class="kt">int</span><span class="p">)</span> <span class="kd">func</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">Person</span> <span class="p">{</span>
  <span class="k">return</span> <span class="kd">func</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="nx">Person</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">Person</span><span class="p">{</span>
      <span class="nx">name</span><span class="p">:</span> <span class="nx">name</span><span class="p">,</span>
      <span class="nx">age</span><span class="p">:</span> <span class="nx">age</span><span class="p">,</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>


<span class="nx">newBaby</span> <span class="o">:=</span> <span class="nf">NewPersonFactory</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="nx">baby</span> <span class="o">:=</span> <span class="nf">newBaby</span><span class="p">(</span><span class="s">&#34;john&#34;</span><span class="p">)</span>

<span class="nx">newTeenager</span> <span class="o">:=</span> <span class="nf">NewPersonFactory</span><span class="p">(</span><span class="mi">16</span><span class="p">)</span>
<span class="nx">teen</span> <span class="o">:=</span> <span class="nf">newTeenager</span><span class="p">(</span><span class="s">&#34;jill&#34;</span><span class="p">)</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="结构型模式">结构型模式</h4>
<p>结构型模式的特点是关注类和对象的组合</p>
<h5 id="策略模式">策略模式</h5>
<p>定义策略接口，并实现不同的策略，策略执行者可以设置不同的策略</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kd">type</span> <span class="nx">IStrategy</span> <span class="kd">interface</span> <span class="p">{</span>
	<span class="nf">do</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">add</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">add</span><span class="p">)</span> <span class="nf">do</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">a</span> <span class="o">+</span> <span class="nx">b</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">reduce</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">reduce</span><span class="p">)</span> <span class="nf">do</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">a</span> <span class="o">-</span> <span class="nx">b</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">Operator</span> <span class="kd">struct</span> <span class="p">{</span>
	<span class="nx">strategy</span> <span class="nx">IStrategy</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">Operator</span><span class="p">)</span> <span class="nf">setStrategy</span><span class="p">(</span><span class="nx">strategy</span> <span class="nx">IStrategy</span><span class="p">)</span> <span class="p">{</span>
	<span class="nx">o</span><span class="p">.</span><span class="nx">strategy</span> <span class="p">=</span> <span class="nx">strategy</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">Operator</span><span class="p">)</span> <span class="nf">calculate</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span> <span class="kt">int</span><span class="p">)</span> <span class="kt">int</span> <span class="p">{</span>
	<span class="k">return</span> <span class="nx">o</span><span class="p">.</span><span class="nx">strategy</span><span class="p">.</span><span class="nf">do</span><span class="p">(</span><span class="nx">a</span><span class="p">,</span> <span class="nx">b</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="模板模式">模板模式</h5>
<p>将一个类中能公共使用的方法放置在抽象类中实现，将不能公共使用的方法作为抽象方法强制子类去实现</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go">
<span class="kn">package</span> <span class="nx">template</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">type</span> <span class="nx">Cooker</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nf">fire</span><span class="p">()</span>
  <span class="nf">cooke</span><span class="p">()</span>
  <span class="nf">outfire</span><span class="p">()</span>
<span class="p">}</span>

<span class="c1">// 类似于一个抽象类
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">CookMenu</span> <span class="kd">struct</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">CookMenu</span><span class="p">)</span> <span class="nf">fire</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;开火&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 做菜，交给具体的子类实现
</span><span class="c1"></span><span class="kd">func</span> <span class="p">(</span><span class="nx">CookMenu</span><span class="p">)</span> <span class="nf">cooke</span><span class="p">()</span> <span class="p">{</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">CookMenu</span><span class="p">)</span> <span class="nf">outfire</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;关火&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 封装具体步骤
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">doCook</span><span class="p">(</span><span class="nx">cook</span> <span class="nx">Cooker</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">cook</span><span class="p">.</span><span class="nf">fire</span><span class="p">()</span>
  <span class="nx">cook</span><span class="p">.</span><span class="nf">cooke</span><span class="p">()</span>
  <span class="nx">cook</span><span class="p">.</span><span class="nf">outfire</span><span class="p">()</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">XiHongShi</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">CookMenu</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="o">*</span><span class="nx">XiHongShi</span><span class="p">)</span> <span class="nf">cooke</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;做西红柿&#34;</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">ChaoJiDan</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">CookMenu</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">ChaoJiDan</span><span class="p">)</span> <span class="nf">cooke</span><span class="p">()</span> <span class="p">{</span>
  <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;做炒鸡蛋&#34;</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h4 id="行为型模式">行为型模式</h4>
<p>行为模式的特点是关注对象之间的通信</p>
<h5 id="代理模式">代理模式</h5>
<p>代理模式Proxy pattern 可以为另外一个对象提供一个替身或者占位符，以控制对这个对象的访问</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go">
<span class="kn">package</span> <span class="nx">proxy</span>

<span class="kn">import</span> <span class="s">&#34;fmt&#34;</span>

<span class="kd">type</span> <span class="nx">Seller</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nf">sell</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// 火车站
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Station</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">stock</span> <span class="kt">int</span> <span class="c1">//库存
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">station</span> <span class="o">*</span><span class="nx">Station</span><span class="p">)</span> <span class="nf">sell</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">station</span><span class="p">.</span><span class="nx">stock</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">station</span><span class="p">.</span><span class="nx">stock</span><span class="o">--</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;代理点中：%s买了一张票,剩余：%d \n&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">station</span><span class="p">.</span><span class="nx">stock</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;票已售空&#34;</span><span class="p">)</span>
  <span class="p">}</span>

<span class="p">}</span>

<span class="c1">// 火车代理点
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">StationProxy</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">station</span> <span class="o">*</span><span class="nx">Station</span> <span class="c1">// 持有一个火车站对象
</span><span class="c1"></span><span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">proxy</span> <span class="o">*</span><span class="nx">StationProxy</span><span class="p">)</span> <span class="nf">sell</span><span class="p">(</span><span class="nx">name</span> <span class="kt">string</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">station</span><span class="p">.</span><span class="nx">stock</span> <span class="p">&gt;</span> <span class="mi">0</span> <span class="p">{</span>
    <span class="nx">proxy</span><span class="p">.</span><span class="nx">station</span><span class="p">.</span><span class="nx">stock</span><span class="o">--</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Printf</span><span class="p">(</span><span class="s">&#34;代理点中：%s买了一张票,剩余：%d \n&#34;</span><span class="p">,</span> <span class="nx">name</span><span class="p">,</span> <span class="nx">proxy</span><span class="p">.</span><span class="nx">station</span><span class="p">.</span><span class="nx">stock</span><span class="p">)</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">fmt</span><span class="p">.</span><span class="nf">Println</span><span class="p">(</span><span class="s">&#34;票已售空&#34;</span><span class="p">)</span>
  <span class="p">}</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h5 id="选项模式">选项模式</h5>
<p>通过选项模式可以创建一个带有默认值得struct变量，并选择性的修改其中一些参数的值</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-go" data-lang="go"><span class="kn">package</span> <span class="nx">options</span>

<span class="kn">import</span> <span class="p">(</span>
  <span class="s">&#34;time&#34;</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">Connection</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">addr</span>    <span class="kt">string</span>
  <span class="nx">cache</span>   <span class="kt">bool</span>
  <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="p">(</span>
  <span class="nx">defaultTimeout</span> <span class="p">=</span> <span class="mi">10</span>
  <span class="nx">defaultCaching</span> <span class="p">=</span> <span class="kc">false</span>
<span class="p">)</span>

<span class="kd">type</span> <span class="nx">options</span> <span class="kd">struct</span> <span class="p">{</span>
  <span class="nx">timeout</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span>
  <span class="nx">caching</span> <span class="kt">bool</span>
<span class="p">}</span>

<span class="c1">// Option overrides behavior of Connect.
</span><span class="c1"></span><span class="kd">type</span> <span class="nx">Option</span> <span class="kd">interface</span> <span class="p">{</span>
  <span class="nf">apply</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">type</span> <span class="nx">optionFunc</span> <span class="kd">func</span><span class="p">(</span><span class="o">*</span><span class="nx">options</span><span class="p">)</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">f</span> <span class="nx">optionFunc</span><span class="p">)</span> <span class="nf">apply</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
  <span class="nf">f</span><span class="p">(</span><span class="nx">o</span><span class="p">)</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithTimeout</span><span class="p">(</span><span class="nx">t</span> <span class="nx">time</span><span class="p">.</span><span class="nx">Duration</span><span class="p">)</span> <span class="nx">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">optionFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">timeout</span> <span class="p">=</span> <span class="nx">t</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="nf">WithCaching</span><span class="p">(</span><span class="nx">cache</span> <span class="kt">bool</span><span class="p">)</span> <span class="nx">Option</span> <span class="p">{</span>
  <span class="k">return</span> <span class="nf">optionFunc</span><span class="p">(</span><span class="kd">func</span><span class="p">(</span><span class="nx">o</span> <span class="o">*</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nx">caching</span> <span class="p">=</span> <span class="nx">cache</span>
  <span class="p">})</span>
<span class="p">}</span>

<span class="c1">// Connect creates a connection.
</span><span class="c1"></span><span class="kd">func</span> <span class="nf">NewConnect</span><span class="p">(</span><span class="nx">addr</span> <span class="kt">string</span><span class="p">,</span> <span class="nx">opts</span> <span class="o">...</span><span class="nx">Option</span><span class="p">)</span> <span class="p">(</span><span class="o">*</span><span class="nx">Connection</span><span class="p">,</span> <span class="kt">error</span><span class="p">)</span> <span class="p">{</span>
  <span class="nx">options</span> <span class="o">:=</span> <span class="nx">options</span><span class="p">{</span>
    <span class="nx">timeout</span><span class="p">:</span> <span class="nx">defaultTimeout</span><span class="p">,</span>
    <span class="nx">caching</span><span class="p">:</span> <span class="nx">defaultCaching</span><span class="p">,</span>
  <span class="p">}</span>

  <span class="k">for</span> <span class="nx">_</span><span class="p">,</span> <span class="nx">o</span> <span class="o">:=</span> <span class="k">range</span> <span class="nx">opts</span> <span class="p">{</span>
    <span class="nx">o</span><span class="p">.</span><span class="nf">apply</span><span class="p">(</span><span class="o">&amp;</span><span class="nx">options</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">return</span> <span class="o">&amp;</span><span class="nx">Connection</span><span class="p">{</span>
    <span class="nx">addr</span><span class="p">:</span>    <span class="nx">addr</span><span class="p">,</span>
    <span class="nx">cache</span><span class="p">:</span>   <span class="nx">options</span><span class="p">.</span><span class="nx">caching</span><span class="p">,</span>
    <span class="nx">timeout</span><span class="p">:</span> <span class="nx">options</span><span class="p">.</span><span class="nx">timeout</span><span class="p">,</span>
  <span class="p">},</span> <span class="kc">nil</span>
<span class="p">}</span>
</code></pre></td></tr></table>
</div>
</div><h2 id="基础功能设计和开发">基础功能设计和开发</h2>
<h3 id="api风格">API风格</h3>
<h4 id="restful-api设计原则">Restful API设计原则</h4>
<h5 id="uri设计">URI设计</h5>
<p>通常情况下：</p>
<ul>
<li>资源使用名词复数表示</li>
<li>URI结尾不包含<code>/</code></li>
<li>推荐使用<code>-</code></li>
<li>使用小写</li>
<li>避免层级过深，超过2层时将其他资源转为？参数，比如</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell">/schools/tsinghua/classes/rooma/students/zhang <span class="c1"># 不推荐</span>
/students?school<span class="o">=</span>qinghua<span class="p">&amp;</span><span class="nv">class</span><span class="o">=</span>rooma <span class="c1"># 推荐</span>
</code></pre></td></tr></table>
</div>
</div><p>实际场景中某些操作不能很好地映射为资源，可以参考如下做法：</p>
<ul>
<li>将一个操作变成一个资源的属性，比如禁用用户可以设计URI: /users/zhangsan?active=false</li>
<li>将操作当做是一个资源的嵌套资源，如github star:</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback">PUT /gits/:id/star
DELETE /gits/:id/star
</code></pre></td></tr></table>
</div>
</div><ul>
<li>有时也可以打破规范，如登录操作URI设计为：/login</li>
</ul>
<h5 id="rest资源操作和http方法之间的映射">REST资源操作和HTTP方法之间的映射</h5>
<p><img src="/image/go_develop_in_action/12_1.webp" alt="resource-operation"></p>
<p>对资源的操作应蛮子安全性和幂等性：</p>
<ul>
<li>安全性：不会改变资源状态，可以理解为只读</li>
<li>幂等性：执行1次和执行N次，对资源状态改变的效果是等价的</li>
</ul>
<p><img src="/image/go_develop_in_action/12_2.webp" alt="idempotence"></p>
<p>POST一般用在新建和批量删除这两种场景，批量删除更建议使用：DELETE /users?id=1,2,3</p>
<h5 id="统一分页过滤排序搜索功能">统一分页/过滤/排序/搜索功能</h5>
<ul>
<li>分页：在列出一个Collection所有Member时应该提供分页功能，如：/users?offset=0&amp;limit=20</li>
<li>过滤：当不用返回一个资源的全部属性时可以指定，如：/users?fields=email,username,address</li>
<li>排序：根据指定字段排序，如：/users?sort=age,desc</li>
<li>搜索：当一个资源的Member太多时，可能需要提供搜索功能，搜索建议按模糊搜索来匹配</li>
</ul>
<h5 id="域名">域名</h5>
<p>主要有两种方式：</p>
<ul>
<li><a href="https://abc.com/api">https://abc.com/api</a> 适用该域名只有一套API系统的情况</li>
<li><a href="https://project.api.abc.com">https://project.api.abc.com</a> 适用域名下有多个系统API</li>
</ul>
<h4 id="rpc-api">RPC API</h4>
<p>RPC（Remote Procedure Call）即远程过程调用，通俗地来讲就是服务端实现了一个函数，
客户端使用RPC框架提供的接口，想调用本地函数一样调用这个函数，并获取返回值。</p>
<p>protobuf3可以使用<code>optional</code>关键字来支持显示判断是否传入该字段</p>
<ul>
<li>golang会将该字段转为指针类型，可以判断是否为<code>nil</code></li>
<li>python可以通过<code>HasField</code>方法来判断</li>
</ul>
<p>可以通过grpc-gateway来同时支持restful-api</p>
<p><img src="/image/go_develop_in_action/13_1.webp" alt="rpc-vs-rest"></p>
<h3 id="makefile">Makefile</h3>
<h2 id="参考">参考</h2>
<ul>
<li><a href="https://time.geekbang.org/column/intro/418">课程资源-Go 语言项目开发实战</a></li>
<li><a href="https://www.techgrow.cn/posts/5bd5a253.html">gcc升级</a></li>
<li><a href="https://github.com/protocolbuffers/protobuf/blob/master/docs/implementing_proto3_presence.md">proto3支持optional</a></li>
</ul>

    </div>

    
    


    
    

    <footer class="post-footer">
      <div class="post-tags">
          <a href="https://ppd0705.github.io/tags/golang/">Golang</a>
          
        </div>

      
      <nav class="post-nav">
        
        
          <a class="next" href="/post/learning_vue/">
            <span class="next-text nav-default">[笔记]VueJS学习</span>
            <span class="prev-text nav-mobile">Next</span>
            
            <i class="iconfont">
              <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="18" height="18">
  <path d="M332.091514 74.487481l-75.369571 89.491197c-10.963703 12.998035-10.285251 32.864502 1.499144 44.378743l286.278095 300.375162L266.565125 819.058374c-11.338233 12.190647-11.035334 32.285311 0.638543 44.850487l80.46666 86.564541c11.680017 12.583596 30.356378 12.893658 41.662889 0.716314l377.434212-421.426145c11.332093-12.183484 11.041474-32.266891-0.657986-44.844348l-80.46666-86.564541c-1.772366-1.910513-3.706415-3.533476-5.750981-4.877077L373.270379 71.774697C361.493148 60.273758 343.054193 61.470003 332.091514 74.487481z"></path>
</svg>

            </i>
          </a>
      </nav>
    </footer>
  </article>

  
  

  
  

  

  
  
    <div class="post bg-white">
      <script src="https://utteranc.es/client.js"
            repo= "ppd0705/ppd0705.github.io"
            issue-term="pathname"
            theme="github-light"
            crossorigin="anonymous"
            async>
      </script>
    </div>
  

  

  

  

    

  

        </div>
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="icon-links">
  
  
    <a href="ppd0705@icloud.com" rel="me noopener" class="iconfont"
      title="email"  target="_blank"
      >
      <svg class="icon" viewBox="0 0 1451 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M664.781909 681.472759 0 97.881301C0 3.997201 71.046997 0 71.046997 0L474.477909 0 961.649408 0 1361.641813 0C1361.641813 0 1432.688811 3.997201 1432.688811 97.881301L771.345323 681.472759C771.345323 681.472759 764.482731 685.154773 753.594283 688.65053L753.594283 688.664858C741.602731 693.493018 729.424896 695.068979 718.077952 694.839748 706.731093 695.068979 694.553173 693.493018 682.561621 688.664858L682.561621 688.65053C671.644501 685.140446 664.781909 681.472759 664.781909 681.472759L664.781909 681.472759ZM718.063616 811.603883C693.779541 811.016482 658.879232 802.205449 619.10784 767.734955 542.989056 701.759633 0 212.052267 0 212.052267L0 942.809523C0 942.809523 0 1024 83.726336 1024L682.532949 1024 753.579947 1024 1348.948139 1024C1432.688811 1024 1432.688811 942.809523 1432.688811 942.809523L1432.688811 212.052267C1432.688811 212.052267 893.138176 701.759633 817.019477 767.734955 777.248 802.205449 742.347691 811.03081 718.063616 811.603883L718.063616 811.603883Z"></path>
</svg>

    </a>
  
    <a href="https://github.com/ppd0705" rel="me noopener" class="iconfont"
      title="github"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M512 12.672c-282.88 0-512 229.248-512 512 0 226.261333 146.688 418.133333 350.08 485.76 25.6 4.821333 34.986667-11.008 34.986667-24.618667 0-12.16-0.426667-44.373333-0.64-87.04-142.421333 30.890667-172.458667-68.693333-172.458667-68.693333C188.672 770.986667 155.008 755.2 155.008 755.2c-46.378667-31.744 3.584-31.104 3.584-31.104 51.413333 3.584 78.421333 52.736 78.421333 52.736 45.653333 78.293333 119.850667 55.68 149.12 42.581333 4.608-33.109333 17.792-55.68 32.426667-68.48-113.706667-12.8-233.216-56.832-233.216-253.013333 0-55.893333 19.84-101.546667 52.693333-137.386667-5.76-12.928-23.04-64.981333 4.48-135.509333 0 0 42.88-13.738667 140.8 52.48 40.96-11.392 84.48-17.024 128-17.28 43.52 0.256 87.04 5.888 128 17.28 97.28-66.218667 140.16-52.48 140.16-52.48 27.52 70.528 10.24 122.581333 5.12 135.509333 32.64 35.84 52.48 81.493333 52.48 137.386667 0 196.693333-119.68 240-233.6 252.586667 17.92 15.36 34.56 46.762667 34.56 94.72 0 68.522667-0.64 123.562667-0.64 140.202666 0 13.44 8.96 29.44 35.2 24.32C877.44 942.592 1024 750.592 1024 524.672c0-282.752-229.248-512-512-512"></path>
</svg>

    </a>
  
    <a href="https://www.douban.com/people/ppd0705/" rel="me noopener" class="iconfont"
      title="douban"  target="_blank"
      >
      <svg class="icon" style="" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="36" height="36">
  <path d="M926.917973 37.80608C959.65184 37.80608 986.19392 64.34816 986.19392 97.082027L986.19392 926.917973C986.19392 959.65184 959.65184 986.19392 926.917973 986.19392L97.082027 986.19392C64.34816 986.19392 37.80608 959.65184 37.80608 926.917973L37.80608 97.082027C37.80608 64.34816 64.34816 37.80608 97.082027 37.80608zM176.653653 176.19968 176.653653 252.678827 825.658027 252.678827 825.658027 176.19968zM217.719467 316.146347 217.719467 628.08064 273.524053 628.08064 341.292373 770.39616 157.259093 770.39616 157.259093 845.417813 842.949973 845.417813 842.949973 770.39616 654.226773 770.39616 722.899627 628.08064 783.67744 628.08064 783.67744 316.146347zM684.885333 392.891733 684.885333 553.987413 312.576 553.987413 312.576 392.891733zM570.770773 770.39616 426.653013 770.39616 359.621973 628.08064 639.443627 628.08064z"></path>
</svg>

    </a>


<a href="https://ppd0705.github.io/index.xml" rel="noopener alternate" type="application/rss&#43;xml"
    class="iconfont" title="rss" target="_blank">
    <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="30" height="30">
  <path d="M819.157333 1024C819.157333 574.592 449.408 204.8 0 204.8V0c561.706667 0 1024 462.293333 1024 1024h-204.842667zM140.416 743.04a140.8 140.8 0 0 1 140.501333 140.586667A140.928 140.928 0 0 1 140.074667 1024C62.72 1024 0 961.109333 0 883.626667s62.933333-140.544 140.416-140.586667zM678.784 1024h-199.04c0-263.210667-216.533333-479.786667-479.744-479.786667V345.173333c372.352 0 678.784 306.517333 678.784 678.826667z"></path>
</svg>

  </a>
   
</div>

<div class="copyright">
  <span class="power-by">
    Powered by <a class="hexo-link" href="https://gohugo.io">Hugo</a>
  </span>
  <span class="division">|</span>
  <span class="theme-info">
    Theme - <a class="theme-link" href="https://github.com/xianmin/hugo-theme-jane">Jane</a>
  </span>

  <span class="copyright-year">
    &copy;
    
      2019 -
    2021
    <span class="heart">
      
      <i class="iconfont">
        <svg class="icon" viewBox="0 0 1025 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="14" height="14">
  <path d="M1000.1 247.9c-15.5-37.3-37.6-70.6-65.7-98.9-54.4-54.8-125.8-85-201-85-85.7 0-166 39-221.4 107.4C456.6 103 376.3 64 290.6 64c-75.1 0-146.5 30.4-201.1 85.6-28.2 28.5-50.4 61.9-65.8 99.3-16 38.8-24 79.9-23.6 122.2 0.7 91.7 40.1 177.2 108.1 234.8 3.1 2.6 6 5.1 8.9 7.8 14.9 13.4 58 52.8 112.6 102.7 93.5 85.5 209.9 191.9 257.5 234.2 7 6.1 15.8 9.5 24.9 9.5 9.2 0 18.1-3.4 24.9-9.5 34.5-30.7 105.8-95.9 181.4-165 74.2-67.8 150.9-138 195.8-178.2 69.5-57.9 109.6-144.4 109.9-237.3 0.1-42.5-8-83.6-24-122.2z"
   fill="#8a8a8a"></path>
</svg>

      </i>
    </span><span class="author">
        PPD
        
      </span></span>

  
  

  
</div>

    </footer>

    <div class="back-to-top" id="back-to-top">
      <i class="iconfont">
        
        <svg class="icon" viewBox="0 0 1024 1024" version="1.1"
  xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
  width="35" height="35">
  <path d="M510.866688 227.694839 95.449397 629.218702l235.761562 0-2.057869 328.796468 362.40389 0L691.55698 628.188232l241.942331-3.089361L510.866688 227.694839zM63.840492 63.962777l894.052392 0 0 131.813095L63.840492 195.775872 63.840492 63.962777 63.840492 63.962777zM63.840492 63.962777"></path>
</svg>

      </i>
    </div>
  </div>
  
<script type="text/javascript" src="/lib/jquery/jquery-3.2.1.min.js"></script>
  <script type="text/javascript" src="/lib/slideout/slideout-1.0.1.min.js"></script>




<script type="text/javascript" src="/js/main.638251f4230630f0335d8c6748e53a96f94b72670920b60c09a56fdc8bece214.js" integrity="sha256-Y4JR9CMGMPAzXYxnSOU6lvlLcmcJILYMCaVv3Ivs4hQ=" crossorigin="anonymous"></script>












  
    <script type="text/javascript" src="/js/load-photoswipe.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe.min.js"></script>
    <script type="text/javascript" src="/lib/photoswipe/photoswipe-ui-default.min.js"></script>
  















</body>
</html>
